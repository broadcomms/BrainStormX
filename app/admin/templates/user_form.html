{% extends "admin_base.html" %}

{% if mode == "create" %}
    {% set page_title = "Create user" %}
    {% set subtitle = "Provision a new account and optionally send a welcome email" %}
{% else %}
    {% set page_title = "Edit user" %}
    {% set subtitle = "Update profile details, roles, and visibility" %}
{% endif %}

{% block title %}{{ page_title }} Â· BrainStorm X{% endblock %}
{% block header_title %}{{ page_title }}{% endblock %}
{% block header_subtitle %}{{ subtitle }}{% endblock %}

{% block content %}
<form method="post" class="card shadow-sm">
    {{ form.hidden_tag() }}
    <div class="card-body">
        <div class="row g-3">
            <div class="col-12 col-md-6">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-control" + (' is-invalid' if form.email.errors else '')) }}
                {% if form.email.errors %}
                    <div class="invalid-feedback d-block">{{ form.email.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-md-6">
                {{ form.role.label(class="form-label") }}
                {{ form.role(class="form-select" + (' is-invalid' if form.role.errors else '')) }}
                {% if form.role.errors %}
                    <div class="invalid-feedback d-block">{{ form.role.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-md-6">
                {{ form.first_name.label(class="form-label") }}
                {{ form.first_name(class="form-control" + (' is-invalid' if form.first_name.errors else '')) }}
                {% if form.first_name.errors %}
                    <div class="invalid-feedback d-block">{{ form.first_name.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-md-6">
                {{ form.last_name.label(class="form-label") }}
                {{ form.last_name(class="form-control" + (' is-invalid' if form.last_name.errors else '')) }}
                {% if form.last_name.errors %}
                    <div class="invalid-feedback d-block">{{ form.last_name.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-md-6">
                {{ form.username.label(class="form-label") }}
                {{ form.username(class="form-control" + (' is-invalid' if form.username.errors else '')) }}
                {% if form.username.errors %}
                    <div class="invalid-feedback d-block">{{ form.username.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-md-6">
                {{ form.job_title.label(class="form-label") }}
                {{ form.job_title(class="form-control") }}
            </div>
            <div class="col-12 col-md-6">
                {{ form.organization.label(class="form-label") }}
                {{ form.organization(class="form-control") }}
            </div>
            <div class="col-12 col-md-6">
                <div class="form-check form-switch">
                    {{ form.email_verified(class="form-check-input") }}
                    {{ form.email_verified.label(class="form-check-label") }}
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="form-check form-switch">
                    {{ form.is_public_profile(class="form-check-input") }}
                    {{ form.is_public_profile.label(class="form-check-label") }}
                </div>
            </div>

            {% if mode == "create" %}
                <div class="col-12 col-md-6">
                    {{ form.password.label(class="form-label") }}
                    {{ form.password(class="form-control" + (' is-invalid' if form.password.errors else '')) }}
                    {% if form.password.errors %}
                        <div class="invalid-feedback d-block">{{ form.password.errors[0] }}</div>
                    {% endif %}
                </div>
                <div class="col-12 col-md-6">
                    <div class="form-check form-switch">
                        {{ form.send_welcome_email(class="form-check-input") }}
                        {{ form.send_welcome_email.label(class="form-check-label") }}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="card-footer bg-body-tertiary d-flex flex-column flex-sm-row gap-2 justify-content-between align-items-sm-center">
        <div class="text-body-secondary small">Updates apply immediately after saving.</div>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary" href="{{ url_for('admin.user_list') }}">Cancel</a>
            <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
    </div>
</form>
{% endblock %}
